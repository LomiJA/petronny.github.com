<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archiv: 2015 | Jingbei Li&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Jingbei Li's Blog">
<meta property="og:url" content="http://jingbei.li/archives/2015/index.html">
<meta property="og:site_name" content="Jingbei Li's Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jingbei Li's Blog">
  
    <link rel="alternate" href="/atom.xml" title="Jingbei Li&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Jingbei Li&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://jingbei.li"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-我来给大家科普一下什么叫C模拟面向对象" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/29/我来给大家科普一下什么叫C模拟面向对象/" class="article-date">
  <time datetime="2015-12-29T00:00:00.000Z" itemprop="datePublished">Dec 29 2015</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/29/我来给大家科普一下什么叫C模拟面向对象/">我来给大家科普一下什么叫C模拟面向对象</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h4><p>唉。。这个题本来是我给本校一门C++的课出的期末考试题，无奈被批”平常老嘱咐不要写C风格的程序”，然后就被干掉了。。但是这个技能本身还是有一定意义的，在此我就直接把原题目的空都填好了分享给大家。</p>
<p>注：下面这堆中，声明都是真的，实现都是我口胡的。最近口胡能力越来越强了。。。</p>
<h4 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h4><p>Pebble是一款于2013年初上市的智能手表，具有一块类似Kindle的黑白电子墨水屏，支持蓝牙链接以便从手机获取消息通知。<br>相对于今天才上市的Apple Watch，Pebble更加开放和友好的开发环境赢得了广大Geek的青睐。</p>
<p><img src="http://7sbplw.com1.z0.glb.clouddn.com/pebble.png" alt="pebble"><br><img src="http://7sbplw.com1.z0.glb.clouddn.com/pebble-watchface.png" alt="pebble-time"></p>
<p>虽说开发环境比较友好，但是，并！没！有！C++编译器，基本的开发语言只有C。。。</p>
<p><strong>但是，这并不妨碍你使用C来开发一个简单的Pebble程序</strong>，通过本学期的学习，你已经掌握了C语言的很多语法。</p>
<p>|C和C++共同的语法部分（本题中可以使用）|C语言不具备的语法（本题中无法使用的）|<br>|基本的数据类型|class,namespace,template|<br>|数组及指针|struct中无法包含函数体|<br>|循环体及函数体|string数据类型|<br>|宏语句|new与delete语句|</p>
<p><strong>并且，即便没有class，也并不妨碍你使用面向对象的思想来开发程序。</strong></p>
<p>我们现在就来尝试使用C来模拟出一个类，由于没有class，我们只能先用struct来构建出他的数据部分：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div></pre></td></tr></table></figure></p>
<p>我们现在就来尝试使用C来模拟出一个类，由于没有class，我们只能先用struct来构建出他的数据部分：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> GPoint &#123;</div><div class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> x,y;<span class="comment">//表示坐标</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>接下来我们可以用下面的语句来定义GPoint类型的对象了<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> GPoint a_point;</div></pre></td></tr></table></figure></p>
<p>为了调用方便，不如就用typedef把它改造的更像类一些<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> GPoint GPoint;</div></pre></td></tr></table></figure></p>
<p>现在我们就可以摆脱那个struct啦<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">GPoint another_point;</div></pre></td></tr></table></figure></p>
<p>下面这个宏给我们演示了如何模拟出一个构造函数<br>利用{}来构建一个结构对，接下来强制类型转换成GPoint类型并返回<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> GPoint(x, y) ((GPoint)&#123;(x), (y)&#125;)</span></div></pre></td></tr></table></figure></p>
<p>调用就像这样<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a_Point=GPoint(<span class="number">0</span>,<span class="number">0</span>);</div></pre></td></tr></table></figure></p>
<p>上面的struct和typedef两句还可以合并起来写<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> GSize &#123;</div><div class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> w,h;<span class="comment">//表示宽度和高度</span></div><div class="line">&#125; GSize;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> GSize(w, h) ((GSize)&#123;(w), (h)&#125;)</span></div></pre></td></tr></table></figure></p>
<p>接下来我们来构造一个内嵌其他类型的类<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> GRect &#123;<span class="comment">//描述一个矩形方框</span></div><div class="line">	GPoint origin;<span class="comment">//表示这个矩形的原点，即左上角</span></div><div class="line">	GSize size;<span class="comment">//表示这个矩形的大小</span></div><div class="line">&#125; GRect;</div></pre></td></tr></table></figure></p>
<p>现在我们来仿写一个GRect类型的构造函数<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> GRect(x, y, w, h) ((GRect) &#123; &#123;(x), (y) &#125;, &#123;(w), (h)&#125;&#125;)</span></div></pre></td></tr></table></figure></p>
<p>对于简单的，不含函数的类，我们用上面的办法就可以解决了。<br>对于一些更基本的类，甚至可以这样<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> GColor &#123;</div><div class="line">	GColorClear,GColorBlack</div><div class="line">&#125; GColor;</div></pre></td></tr></table></figure></p>
<p>接下来我们来用C来构建一个复杂的基类<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> Layer Layer;</div><div class="line"><span class="keyword">struct</span> Layer &#123;</div><div class="line">	<span class="comment">//对于复杂的类我们需要一个this指针</span></div><div class="line">	Layer* <span class="keyword">this</span>;</div><div class="line">	GRect bounds;</div><div class="line">	<span class="comment">//...</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>现在我们来实现这个类的构造函数<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function">Layer* <span class="title">layer_create</span><span class="params">(GRect bounds)</span> </span>&#123;</div><div class="line">	Layer layer;</div><div class="line">	Layer* <span class="keyword">this</span>=&amp;layer;</div><div class="line">	<span class="keyword">this</span>-&gt;bounds=bounds;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>同样还要有析构函数<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">layer_destroy</span><span class="params">(Layer* <span class="keyword">this</span>)</span> </span>&#123;</div><div class="line">	<span class="built_in">free</span>(<span class="keyword">this</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>接下来定义一个成员函数，开头附加类名来表示这个类的归属<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function">GRect <span class="title">layer_get_bounds</span><span class="params">(Layer* <span class="keyword">this</span>)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>-&gt;bounds;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>以及其他成员函数，他们都以类名开头，第一个参数是这个类的对像的指针。对于一个静态函数，可以这样。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">layer_add_child</span><span class="params">(Layer *parent, Layer *child)</span></span>;</div></pre></td></tr></table></figure></p>
<p>接下来我们来模拟继承自Layer和Text两个类的子类TextLayer<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> TextLayer TextLayer;</div><div class="line"><span class="keyword">struct</span> TextLayer &#123;</div><div class="line">	Layer* layer;<span class="comment">//存储基类的指针</span></div><div class="line">	TextLayer* <span class="keyword">this</span>;<span class="comment">//存储子类的指针</span></div><div class="line">	<span class="comment">//...</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>接下来我们来实现子类的构造函数<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function">TextLayer* <span class="title">text_layer_create</span><span class="params">(GRect bounds)</span> </span>&#123;</div><div class="line">	TextLayer textLayer;</div><div class="line">	TextLayer* <span class="keyword">this</span>= &amp;textLayer;</div><div class="line">	<span class="keyword">this</span>-&gt;layer=layer_create(bounds);</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>以及析构函数<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">text_layer_destroy</span><span class="params">(TextLayer* <span class="keyword">this</span>)</span> </span>&#123;</div><div class="line">	layer_destroy(<span class="keyword">this</span>-&gt;layer);</div><div class="line">	<span class="built_in">free</span>(<span class="keyword">this</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>以及一些成员函数<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function">Layer* <span class="title">text_layer_get_layer</span><span class="params">(TextLayer* <span class="keyword">this</span>)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>-&gt;layer;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">text_layer_set_text</span><span class="params">(TextLayer* text_layer, <span class="keyword">const</span> <span class="keyword">char</span>* text)</span></span>;</div><div class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">char</span>* <span class="title">text_layer_get_text</span><span class="params">(TextLayer* text_layer)</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">text_layer_set_background_color</span><span class="params">(TextLayer* text_layer, GColor color)</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">text_layer_set_text_color</span><span class="params">(TextLayer* text_layer, GColor color)</span></span>;</div></pre></td></tr></table></figure></p>
<p>以及其他成员函数</p>
<p>同样我们还有另一个继承自Layer的类，用来存储图片<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> BitmapLayer BitmapLayer;</div><div class="line"><span class="keyword">struct</span> BitmapLayer &#123;</div><div class="line">	Layer* layer;</div><div class="line">	BitmapLayer* <span class="keyword">this</span>;</div><div class="line">	<span class="comment">//...</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>现在我们还有一个同时继承自TextLayer和BitmapLayer的类<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> TextBitmapLayer TextBitmapLayer;</div><div class="line"><span class="keyword">struct</span> TextBitmapLayer &#123;</div><div class="line">	TextLayer* textLayer;</div><div class="line">	BitmapLayer* bitmapLayer;</div><div class="line">	<span class="comment">//...</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>我们来仿照C++解决类似情况的手法实现这个类的构造函数<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function">TextBitmapLayer* <span class="title">text_bitmap_layer_create</span><span class="params">(GRect bounds)</span> </span>&#123;</div><div class="line">	TextBitmapLayer textBitmapLayer;</div><div class="line">	TextBitmapLayer* <span class="keyword">this</span>=&amp;textBitmapLayer;</div><div class="line">	<span class="keyword">this</span>-&gt;textLayer=text_layer_create(bounds);</div><div class="line">	BitmapLayer bitmapLayer;</div><div class="line">	<span class="keyword">this</span>-&gt;bitmapLayer=&amp;bitmapLayer;</div><div class="line">	<span class="keyword">this</span>-&gt;bitmapLayer-&gt;<span class="keyword">this</span>=&amp;bitmapLayer;</div><div class="line">	<span class="keyword">this</span>-&gt;bitmapLayer-&gt;layer=<span class="keyword">this</span>-&gt;textLayer-&gt;layer;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>以及析构函数<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">text_bitmap_layer_detroy</span><span class="params">(TextBitmapLayer* <span class="keyword">this</span>)</span> </span>&#123;</div><div class="line">	text_layer_destroy(<span class="keyword">this</span>-&gt;textLayer);</div><div class="line">	<span class="built_in">free</span>(<span class="keyword">this</span>-&gt;bitmapLayer);</div><div class="line">	<span class="built_in">free</span>(<span class="keyword">this</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>现在我们就来为pebble实现一个右图中那个简单的watchface吧<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pebble.h&gt;</span></span></div><div class="line"><span class="keyword">static</span> Window* s_main_window;<span class="comment">//表示watchface所属的窗口，即最顶层的Layer</span></div><div class="line"><span class="keyword">static</span> TextLayer* s_time_layer;<span class="comment">//用于显示时间</span></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">update_time</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">//定义每单位时间过去以后的动作</span></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">tick_handler</span><span class="params">(<span class="keyword">struct</span> tm* tick_time, TimeUnits units_changed)</span> </span>&#123;</div><div class="line">	<span class="comment">//获取本地时间</span></div><div class="line">	<span class="keyword">time_t</span> temp = time(<span class="literal">NULL</span>);</div><div class="line">	<span class="keyword">struct</span> tm* tick_time = localtime(&amp;temp);</div><div class="line">	<span class="comment">//生成可读的时间格式</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> s_buffer[<span class="number">8</span>];</div><div class="line">	strftime(s_buffer, <span class="keyword">sizeof</span>(s_buffer), <span class="string">"%H:%M"</span>, tick_time);</div><div class="line">	<span class="comment">//把可读的时间字符串写到全局的TextLayer中</span></div><div class="line">	text_layer_set_text(s_time_layer, s_buffer);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main_window_load</span><span class="params">(Window* window)</span> </span>&#123;</div><div class="line">	<span class="comment">//window包含了一个基础的layer，覆盖了整个显示屏</span></div><div class="line">	Layer* window_layer = window_get_root_layer(window);</div><div class="line">	<span class="comment">//获取显示屏的大小</span></div><div class="line">	GRect bounds = layer_get_bounds(window_layer);</div><div class="line">	<span class="comment">//我们来把中间那个TextLayer放到合适的位置</span></div><div class="line">	s_time_layer = text_layer_create(GRect(<span class="number">0</span>, <span class="number">52</span>, bounds.size.w, <span class="number">50</span>));</div><div class="line">	<span class="comment">//设置背景和文字的颜色</span></div><div class="line">	text_layer_set_background_color(s_time_layer, GColorClear);</div><div class="line">	text_layer_set_text_color(s_time_layer, GColorBlack);</div><div class="line">	<span class="comment">//设置字体和文字的摆放方式</span></div><div class="line">	text_layer_set_font(s_time_layer, FONT_KEY_BITHAM_42_BOLD);</div><div class="line">	text_layer_set_text_alignment(s_time_layer, GTextAlignmentCenter);</div><div class="line">	<span class="comment">//把这个层添加到Window的所属层中，否则不会显示出来</span></div><div class="line">	layer_add_child(window_layer, text_layer_get_layer(s_time_layer));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main_window_unload</span><span class="params">(Window* window)</span> </span>&#123;</div><div class="line">	<span class="comment">//定义这个Window卸载时的动作，要把所有所属层都释放掉</span></div><div class="line">	text_layer_destroy(s_time_layer);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="comment">//创建一个Window</span></div><div class="line">	s_main_window = window_create();</div><div class="line">	<span class="comment">//定义了这个Window的加载与卸载时的动作，用了函数指针来描述多态，看不懂可无视</span></div><div class="line">	window_set_window_handlers(s_main_window, (WindowHandlers) &#123;</div><div class="line">		.load = main_window_load,</div><div class="line">		 .unload = main_window_unload</div><div class="line">	&#125;);</div><div class="line">	<span class="comment">//把我们的watchface压入Window栈的栈顶，这样就可以显示出来了</span></div><div class="line">	<span class="comment">//第二个参数表示启用过场动画</span></div><div class="line">	window_stack_push(s_main_window, <span class="literal">true</span>);</div><div class="line">	<span class="comment">//定义多久触发一次tick_handler</span></div><div class="line">	tick_timer_service_subscribe(MINUTE_UNIT, tick_handler);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">	<span class="comment">//先创建出我们的watchface</span></div><div class="line">	init();</div><div class="line">	<span class="comment">//这一步我们的watchface就持续运行啦</span></div><div class="line">	app_event_loop();</div><div class="line">	<span class="comment">//watchface退出时的动作</span></div><div class="line">	window_destroy(s_main_window);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>编译，运行！但是发现这个watchface显示的时间有时候会与真实时间有误差，请问误差最大是多少？为了降低误差，有什么办法吗？</p>
<blockquote>
<p>最大偏差一分钟，因为每一分钟才调用一次tick_handler。把MINUTE_UNIT改成SECOND_UNIT就好了。</p>
</blockquote>
<h4 id="点评"><a href="#点评" class="headerlink" title="点评"></a>点评</h4><p>我是忍住了才没喷AppleWatch…完全不可用的待机，不防水，必须和ios应用绑定。。真是不行不行的了。。</p>
<p>另外关于多态的实现，其实我早就想用函数指针了，写基类的时候写写删删了好几次。。。无奈还是没写。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jingbei.li/2015/12/29/我来给大家科普一下什么叫C模拟面向对象/" data-id="citb7p0a7000tfxfj8t2r4s6i" class="article-share-link">Teilen</a>
      
        <a href="http://jingbei.li/2015/12/29/我来给大家科普一下什么叫C模拟面向对象/#disqus_thread" class="article-comment-link">Kommentare</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/">c</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/">c++</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-sortbug" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/01/sortbug/" class="article-date">
  <time datetime="2015-10-01T00:00:00.000Z" itemprop="datePublished">Oct 1 2015</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/01/sortbug/">记sort中的一个bug</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这个bug源自我的同学<a href="https://github.com/perypery" target="_blank" rel="external">perypery</a>，在和中文大战三百回合之后。。。</p>
<h3 id="bug具体是这样的"><a href="#bug具体是这样的" class="headerlink" title="bug具体是这样的"></a>bug具体是这样的</h3><p>建立一个包含多的全角正反小括号的文件，一个一行：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ cat test.txt</div><div class="line">）</div><div class="line">）</div><div class="line">（</div><div class="line">（</div></pre></td></tr></table></figure>
<p>然后<code>sort -u test.txt</code>，期望的输出肯定是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sort -u test.txt</div><div class="line">（</div><div class="line">）</div></pre></td></tr></table></figure>
<p>但是实际上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sort -u a.txt</div><div class="line">）</div></pre></td></tr></table></figure>
<p>嗯？怎么回事？<code>（</code>哪里去了？</p>
<h3 id="多版本验证以及降级时遇到的问题"><a href="#多版本验证以及降级时遇到的问题" class="headerlink" title="多版本验证以及降级时遇到的问题"></a>多版本验证以及降级时遇到的问题</h3><p><code>sort</code>来自于<code>coreutils</code>这个软件包，在8.13这个版本时还是好好的。。8.{20,21,22}均有这个问题。<br>于是我先下了一个8.13，打算降级回去，编译的时候发现<code>gets()</code>这个函数已经从<code>stdio.h</code>里面干掉了，编译器表示推荐使用<code>fgets()</code>。</p>
<blockquote>
<p>猜想，是不是因为这个导致获取文本时出现了变化？这个变化使<code>（</code>和<code>）</code>被识别成了同一个字符？</p>
</blockquote>
<h3 id="高版本的解决方案"><a href="#高版本的解决方案" class="headerlink" title="高版本的解决方案"></a>高版本的解决方案</h3><p>经我的同学们调查，这个问题在<a href="http://unix.stackexchange.com/questions/17198/where-has-my-uniq-or-sort-u-line-gone-with-some-unicode-characters" target="_blank" rel="external">这里</a>也有提及。不仅仅<code>sort</code>，<code>uniq</code>也有这个问题。原因果然是被认成了同一个字符。。</p>
<p>不过我的shell内都设置了<code>LANG=zh_CN.UTF-8</code>。按理说不应该啊。。后来发现这个和shell的LOCALE没什么关系，要看Glibc用的是什么LOCALE。对应的就是<code>LC_COLLATE</code>这个变量。不过我把这个变量设置成<code>zh_CN*</code>都没有效果，设置成<code>C</code>(就是<code>POSIX</code>)以后倒是正常了。</p>
<p>所以目前的解决方案就是临时设置一下<code>LC_COLLATE</code>了。因为</p>
<blockquote>
<p>The first rule of LC_COLLATE is: don’t use LC_COLLATE.</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ env LC_COLLATE=C sort -u test.txt</div><div class="line">（</div><div class="line">）</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jingbei.li/2015/10/01/sortbug/" data-id="citb7p09s000kfxfj00wgl19s" class="article-share-link">Teilen</a>
      
        <a href="http://jingbei.li/2015/10/01/sortbug/#disqus_thread" class="article-comment-link">Kommentare</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Thinkpad-E430电池不充电的问题的解决" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/09/23/Thinkpad-E430电池不充电的问题的解决/" class="article-date">
  <time datetime="2015-09-23T00:00:00.000Z" itemprop="datePublished">Sep 23 2015</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/09/23/Thinkpad-E430电池不充电的问题的解决/">Thinkpad E430电池不充电的问题的解决</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这个问题困扰我很长时间了，电池经常充到12%就卡住了。。多种折腾:</p>
<ul>
<li>用一点点下去再充</li>
<li>完全放电</li>
<li>电池扔冰箱里</li>
<li>换电池</li>
</ul>
<p>均无效。最后无奈找微信号联想服务(LenovoServices)咨询，给了一个偏方：</p>
<ul>
<li>关机</li>
<li>把电池和电源都拔了</li>
<li>按住电源健30秒</li>
<li>等3分钟</li>
<li>接回去开始用</li>
</ul>
<p>结果真的能用了。。。</p>
<p>当然那个等3分钟没必要哈。。关键是<code>按住电源健30秒</code>。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jingbei.li/2015/09/23/Thinkpad-E430电池不充电的问题的解决/" data-id="citb7p08j0001fxfjk3heyl3r" class="article-share-link">Teilen</a>
      
        <a href="http://jingbei.li/2015/09/23/Thinkpad-E430电池不充电的问题的解决/#disqus_thread" class="article-comment-link">Kommentare</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hardware/">hardware</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/thinkpad/">thinkpad</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-enable-ipv6-nat-in-openwrt" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/08/26/enable-ipv6-nat-in-openwrt/" class="article-date">
  <time datetime="2015-08-26T00:00:00.000Z" itemprop="datePublished">Aug 26 2015</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/08/26/enable-ipv6-nat-in-openwrt/">Openwrt 15.05rc1 HG255D的ipv6支持</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>感谢<a href="blog.rjjacky.info">rjjacky</a>把他的HG255D转手给我折腾openwrt了。这次折腾的主要目标是ipv6支持。</p>
<h3 id="首先是蛋疼的固件"><a href="#首先是蛋疼的固件" class="headerlink" title="首先是蛋疼的固件"></a>首先是蛋疼的固件</h3><p>openwrt对hg255d的支持至少我从15.05rc2就已经看不到了。。我先尝试自己编译一个。</p>
<p>openwrt自己的wiki上的编译guide就好几种。。根本不知道是哪个，并且除了<code>make menuconfig</code>以外还有很多隐藏的地方要改。<br>经过几次编译，没有一次flash进去能用的。。。放弃。。</p>
<p>后来从<a href="http://www.right.com.cn/Forum/thread-167159-1-1.html" target="_blank" rel="external">此处</a>下载了一个15.05-rc1带部分ipv6的固件，总算刷进去了。</p>
<p>这个固件还算不错，wan和wan6直接就获取到ipv6地址了，lan内部能获取到一个由dhcpv6分配的有奇怪prefix的ipv6地址。</p>
<p>不过没有意义，lan内的机器还是访问不了ipv6的外网。</p>
<p>于是，我的第一反应：</p>
<h3 id="做个ipv6的nat"><a href="#做个ipv6的nat" class="headerlink" title="做个ipv6的nat"></a>做个ipv6的nat</h3><h4 id="part1"><a href="#part1" class="headerlink" title="part1"></a>part1</h4><p>参见<a href="http://www.7forz.com/2555/" target="_blank" rel="external">这篇blog</a></p>
<ul>
<li>opkg装kmod-ip6tables，kmod-ipt-nat6。</li>
</ul>
<blockquote>
<p>装的时候的小插曲：源里面有个链接失效了，注释掉吧先。。</p>
</blockquote>
<ul>
<li>然后运行 <code>ip6tables -t nat -L</code> 检测一下。</li>
</ul>
<p>不过他之后这句</p>
<blockquote>
<p>在开机启动脚本上添加ifconfig br-lan xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx/64</p>
</blockquote>
<p>看起来有点不雅。。</p>
<h4 id="part2"><a href="#part2" class="headerlink" title="part2"></a>part2</h4><p>于是我想到了之前看到的知乎上的<a href="http://www.zhihu.com/question/29667477/answer/47149165" target="_blank" rel="external">这个问题</a>的第一个回答，可以把wan获取到的ipv6地址弄到lan上去。</p>
<p>所以下一步的配置是</p>
<ul>
<li>在LuCI界面删除LAN-ipv6配置下的Global ULA-Prefix里面的数值</li>
<li>修改/etc/config/dhcp的对应片段如下，请用脑子改</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">config dhcp &apos;lan&apos;</div><div class="line">	option interface &apos;lan&apos;</div><div class="line">	option start &apos;100&apos;</div><div class="line">	option limit &apos;150&apos;</div><div class="line">	option leasetime &apos;12h&apos;</div><div class="line">	option ra &apos;hybrid&apos;</div><div class="line">	option dhcpv6 &apos;hybrid&apos;</div><div class="line">	option ndp &apos;hybrid&apos;</div><div class="line">	option ra_management &apos;1&apos;</div><div class="line">config dhcp &apos;wan6&apos;</div><div class="line">	option interface &apos;wan&apos;</div><div class="line">	option dhcpv6 &apos;hybrid&apos;</div><div class="line">	option ra &apos;hybrid&apos;</div><div class="line">	option ndp &apos;hybrid&apos;</div><div class="line">	option master &apos;1&apos;</div></pre></td></tr></table></figure>
<ul>
<li>确保odhcpd是处于开机启动状态</li>
</ul>
<blockquote>
<p>如果现在重启，正常的情况应该是，LAN会获得wan处的ipv6地址（同为2001开头），然后LAN下面的设备各自获得自己的ipv6地址。<br>这样连radvd也不用管了～</p>
</blockquote>
<h4 id="part3"><a href="#part3" class="headerlink" title="part3"></a>part3</h4><p>好现在回到part1的那篇blog，做最后一步：</p>
<ul>
<li>在 /etc/firewall.user 中加入</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ip6tables -t nat -I POSTROUTING -s xxxx:xxxx:xxxx:xxxx::/64 -j MASQUERADE  #其中的IP是LAN的前4段</div></pre></td></tr></table></figure>
<ul>
<li>Reboot and enjoy～</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jingbei.li/2015/08/26/enable-ipv6-nat-in-openwrt/" data-id="citb7p09c000bfxfjjdjgq0uu" class="article-share-link">Teilen</a>
      
        <a href="http://jingbei.li/2015/08/26/enable-ipv6-nat-in-openwrt/#disqus_thread" class="article-comment-link">Kommentare</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ipv6/">ipv6</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openwrt/">openwrt</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-custom-update-for-stargrail-lite-edition" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/07/30/custom-update-for-stargrail-lite-edition/" class="article-date">
  <time datetime="2015-07-30T00:00:00.000Z" itemprop="datePublished">Jul 30 2015</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/30/custom-update-for-stargrail-lite-edition/">《星杯传说 破晓》的人物技能平衡调整</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>《星杯传说 破晓》原版的人物平衡性就有所欠缺，在扩展包《龙族复兴》加入以后这一点就变得更为突出。<br>为了让这个游戏还能玩，我个人对其中的人物技能做了下述调整。</p>
<ul>
<li>被增强的角色：游侠 占星家 皇家侍卫 血天使 暗之王女</li>
<li><p>被削弱的角色：星纹师 龙之契约者 真龙女王</p>
<!--* 无调整的角色：龙之契约者 天马骑士 圣堂刺客 炼金术士 咒术师 驱魔者 龙骑统帅 风暴执政官 剑舞者 大地武士 龙语者 幽魂法师 霜雪公主 裁决者 心灵塑师 战歌祭司-->
</li>
<li><p>进一步的调整打算：</p>
<ul>
<li>buff list: 圣堂刺客 血天使 驱魔者</li>
<li>nerf list: 龙语者 裁决者</li>
</ul>
</li>
</ul>
<h3 id="被增强的角色"><a href="#被增强的角色" class="headerlink" title="被增强的角色"></a>被增强的角色</h3><ul>
<li>游侠<ul>
<li>【追风刺】：你的风神斩就是黯灭。</li>
</ul>
</li>
<li>占星家<ul>
<li>增加效果：如果你的所有预兆牌都是风神斩和地裂斩，则增加一张预兆牌，可多次发动。</li>
</ul>
</li>
<li>皇家侍卫<ul>
<li>【神圣护卫】：【当本方角色受到伤害并导致X点士气下降后发动】你分配X点治疗。</li>
</ul>
</li>
<li>血天使<ul>
<li>【炼雷地狱】：【弃总计2张的雷系或地系牌】对一名对手造成2点法术伤害。</li>
</ul>
</li>
<li>暗之王女<ul>
<li>增加效果：任何时候你都可以用黯灭应战。</li>
<li>【镇魂曲】：【攻击命中，伤害结算后发动，弃X张法术牌】对本次攻击的对手和自己各造成额外X点法术伤害。</li>
</ul>
</li>
</ul>
<h3 id="被削弱的角色"><a href="#被削弱的角色" class="headerlink" title="被削弱的角色"></a>被削弱的角色</h3><ul>
<li>星纹师<ul>
<li>【命运雕刻】：指定一名不少于2张手牌的队友给你2张牌，之后将手中的2张牌交给任意一名队友，我方战绩区+1宝石。</li>
</ul>
</li>
<li>真龙女王<ul>
<li>移除【龙魂守护】</li>
<li>【真龙觉醒】：满足以下条件时，翻转任意1张“禁制”牌，在你的回合结束时，强制重新翻回所有“禁制”牌。<ul>
<li>我方因收到伤害导致士气下降时</li>
<li>场上有星杯合成时</li>
</ul>
</li>
<li>增加效果：你只能按照【龙神恩惠】【龙王神力】【百万龙炎】【圣龙威压】的顺序翻开及移除禁制。</li>
<li>增加效果：每发动一次【龙族复兴】，【龙族复兴】所需的宝石数量+1。</li>
<li>【龙王神力】：【主动攻击命中后弃X张异系牌】本次伤害额外+X，“龙脉束缚”存在时不能发动该技能</li>
<li>【百万龙炎】：【弃X张同系牌】对自己和任一对手各造成X点法术伤害，“龙狂迷锁”存在时不能发动该技能。</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jingbei.li/2015/07/30/custom-update-for-stargrail-lite-edition/" data-id="citb7p0990009fxfjsagvdgci" class="article-share-link">Teilen</a>
      
        <a href="http://jingbei.li/2015/07/30/custom-update-for-stargrail-lite-edition/#disqus_thread" class="article-comment-link">Kommentare</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/desktop-game/">desktop game</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-the-httpdini-redirect-rules-for-yourls" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/02/02/the-httpdini-redirect-rules-for-yourls/" class="article-date">
  <time datetime="2015-02-02T00:00:00.000Z" itemprop="datePublished">Feb 2 2015</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/02/02/the-httpdini-redirect-rules-for-yourls/">The httpd.ini redirect rules for YOURLS</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>The <code>.htaccess</code> for <a href="http://yourls.org/" target="_blank" rel="external">YOURLS</a> will not work on Windows servers.<br>Although YOURLS has noticed that and will create <code>web.config</code> automatically on Windows, my first url shortener site, <a href="http://url.jingbei.li/" target="_blank" rel="external">url.jingbei.li</a> still cannot redirect links as my expect.</p>
<p>The reason is the Windows server I used is an old IIS server not a IIS7 server, the rewrite rules file should be <code>httpd.ini</code>, not <code>web.config</code>.</p>
<p>And <code>REQUEST_FILENAME</code> does not check the local files because it is relative. The current solution is writing all the file names and directory name manually to <code>httpd.ini</code>. It is a little silly, but works.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[ISAPI_Rewrite]</div><div class="line">RewriteRule /admin(.*) /admin$1 [L]</div><div class="line">RewriteRule /css(.*) /css$1 [L]</div><div class="line">RewriteRule /images(.*) /images$1 [L]</div><div class="line">RewriteRule /includes(.*) /includes$1 [L]</div><div class="line">RewriteRule /js(.*) /js$1 [L]</div><div class="line">RewriteRule /pages(.*) /pages$1 [L]</div><div class="line">RewriteRule /user(.*) /user$1 [L]</div><div class="line">RewriteRule /(.*).html /$1.html [L]</div><div class="line">RewriteRule /(.*).php /$1.php [L]</div><div class="line">RewriteRule /.+ /yourls-loader.php [L]</div></pre></td></tr></table></figure>
<h4 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h4><p>I’ve also resigned another domain, <a href="http://pturl.tk/" target="_blank" rel="external">pturl.tk</a>. It does the same things that url.jingbei.li does, but much shorter. :)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jingbei.li/2015/02/02/the-httpdini-redirect-rules-for-yourls/" data-id="citb7p09x000lfxfj9eim0yp5" class="article-share-link">Teilen</a>
      
        <a href="http://jingbei.li/2015/02/02/the-httpdini-redirect-rules-for-yourls/#disqus_thread" class="article-comment-link">Kommentare</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">php</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/windows/">windows</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/yourls/">yourls</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-moved-to-jingbeili" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/01/26/moved-to-jingbeili/" class="article-date">
  <time datetime="2015-01-26T00:00:00.000Z" itemprop="datePublished">Jan 26 2015</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/26/moved-to-jingbeili/">Moved to jingbei.li</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><code>.li</code> is the ccTLD(Internet country code top-level domain) for Liechtenstein. I first saw this domain is at <a href="http://www.iisp.com" target="_blank" rel="external">iisp.com</a>. The price is pretty high(about $40/year) and made me give up.</p>
<p>It so happened that this domain is also sold at <a href="http://www.namecheap.com" target="_blank" rel="external">namecheap</a> with 14.99$/year. According to the significance of this domain to me and such a low price, I bought it with no second thought.</p>
<p>BTW, I also set up a custom email with this domain, <a href="mailto:i@jingbei.li">i@jingbei.li</a>. But my old main email account seems to need a long time to fade out.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jingbei.li/2015/01/26/moved-to-jingbeili/" data-id="citb7p09e000dfxfjs34883mu" class="article-share-link">Teilen</a>
      
        <a href="http://jingbei.li/2015/01/26/moved-to-jingbeili/#disqus_thread" class="article-comment-link">Kommentare</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/logs/">logs</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-a-simple-bat-script-to-splicing-videos" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/01/23/a-simple-bat-script-to-splicing-videos/" class="article-date">
  <time datetime="2015-01-23T00:00:00.000Z" itemprop="datePublished">Jan 23 2015</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/23/a-simple-bat-script-to-splicing-videos/">A simple bat script to splicing videos</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Well, actually it’s a task given by my uncle. So the spirit of this script should be KISS, “Keep It Simple, Stupid”.</p>
<p>Instead of GUI, I choose ffmpeg to be the decoder(and the encoder if necessary). Luckily, ffmpeg has a <a href="http://ffmpeg.zeranoe.com/builds/" target="_blank" rel="external">static windows binary build</a>. A good start!</p>
<p>The next part is writing a KISS script for windows. Because I’m not familiar to bat files at all, it took a while before I finally found out a trick to solve a problem about processing the files’ name.</p>
<p>The final version of the script looks like the following:</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">@<span class="built_in">echo</span> off</div><div class="line"><span class="built_in">cd</span> /d %~dp0</div><div class="line"><span class="built_in">set</span> ffmpeg=bin\ffmpeg.exe</div><div class="line"><span class="built_in">del</span> filelist.txt</div><div class="line"><span class="built_in">del</span> splicing.mkv</div><div class="line">:LOOP</div><div class="line"><span class="keyword">IF</span> [%<span class="number">1</span>]==[] <span class="keyword">GOTO</span> END</div><div class="line">	<span class="built_in">set</span> filename=%<span class="number">1</span></div><div class="line">	<span class="built_in">echo</span> file ^'%~<span class="number">1</span>^' &gt;&gt;filelist.txt </div><div class="line">	<span class="built_in">SHIFT</span></div><div class="line"><span class="keyword">GOTO</span> LOOP</div><div class="line">:END</div><div class="line"><span class="variable">%ffmpeg%</span> -f concat -i filelist.txt -c <span class="built_in">copy</span> splicing.mkv</div><div class="line"><span class="built_in">rename</span> splicing.mkv spliced.mkv</div><div class="line"><span class="built_in">del</span> filelist.txt</div></pre></td></tr></table></figure>
<p>The trick is using <code>%~1</code> to remove the <code>&quot;</code> around the strings with spaces. Then force adding <code>&#39;</code> around all the filenames or else the <code>\</code> will be escaped.</p>
<p>The usage of this script is quite simple. Make sure <code>bin\ffmpeg.exe</code> exist then drag all the videos to the script file.<br>By default, it will not recode the videos to increase efficiency. If it goes wrong, such as splicing videos with different sizes, or the videos need to recode, just edit the ffmpeg command to fix it.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jingbei.li/2015/01/23/a-simple-bat-script-to-splicing-videos/" data-id="citb7p08y0004fxfjqx5v9snk" class="article-share-link">Teilen</a>
      
        <a href="http://jingbei.li/2015/01/23/a-simple-bat-script-to-splicing-videos/#disqus_thread" class="article-comment-link">Kommentare</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bat/">bat</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ffmpeg/">ffmpeg</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/script/">script</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/windows/">windows</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-a-simple-byobu-script-to-notify-your-new-mails-and-feeds" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/01/09/a-simple-byobu-script-to-notify-your-new-mails-and-feeds/" class="article-date">
  <time datetime="2015-01-09T00:00:00.000Z" itemprop="datePublished">Jan 9 2015</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/09/a-simple-byobu-script-to-notify-your-new-mails-and-feeds/">A colorful byobu script to notify your new mails and feeds</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>After <a href="../../../../2014/12/29/using-rssdrop-to-read-feeds-in-mutt/">delivering all the feeds to Maildirs by rssdrop</a>, I also need a notification daemon in my byobu shell.</p>
<p>Byobu supports custom script and display the outputs in the bottom bar. And particularly, you can <a href="../../../../2014/11/11/show-colors-in-byobu-control-bar/">use colors in byobu script’s output</a>!</p>
<p><img src="http://7sbplw.com1.z0.glb.clouddn.com/screenshot-20150109_155440.png" alt="img"></p>
<p>Here is my notification script at <code>~/.byobu/bin/5_mail</code>. 5 means checking every 5 seconds. Byobu will force all the scripts those period is shorter than 5 seconds to run as 5.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/bin/sh -e</span></div><div class="line">MAILDIR=<span class="string">"/home/<span class="variable">$USER</span>/Mail/Yahoo/Inbox"</span></div><div class="line">LOCK=<span class="string">"/home/<span class="variable">$USER</span>/桌面/新邮件.desktop"</span></div><div class="line">LOCKFILE=<span class="string">"/home/<span class="variable">$USER</span>/.byobu/bin/新邮件.desktop"</span></div><div class="line">MSGICON=<span class="string">"/usr/share/icons/Faenza/apps/scalable/gmail.svg"</span></div><div class="line">ICON_MAIL=<span class="string">"[新邮件!]"</span></div><div class="line">COLOR_SET=<span class="string">"#[fg=red bg=white bold]"</span></div><div class="line">COLOR_RESTORE=<span class="string">"#[fg=<span class="variable">$BYOBU_LIGHT</span> bg=<span class="variable">$BYOBU_DARK</span>]"</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ ! <span class="string">"`ls <span class="variable">$MAILDIR</span>/new`"</span> = <span class="string">""</span> ] ; <span class="keyword">then</span></div><div class="line">	<span class="built_in">echo</span> <span class="string">"<span class="variable">$COLOR_SET</span>"</span><span class="string">"<span class="variable">$ICON_MAIL</span>"</span><span class="string">"<span class="variable">$COLOR_RESTORE</span>"</span></div><div class="line">	<span class="keyword">if</span> [ ! <span class="_">-f</span> <span class="variable">$LOCK</span> ]; <span class="keyword">then</span></div><div class="line">		cp <span class="variable">$LOCKFILE</span> <span class="variable">$LOCK</span></div><div class="line">		notify-send -i <span class="variable">$MSGICON</span> <span class="string">"新邮件"</span> <span class="variable">$ICON_MAIL</span></div><div class="line">	<span class="keyword">fi</span></div><div class="line"><span class="keyword">else</span></div><div class="line">	rm <span class="_">-f</span> <span class="variable">$LOCK</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="built_in">cd</span> /home/<span class="variable">$USER</span>/Mail/rss/</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> *</div><div class="line"><span class="keyword">do</span></div><div class="line">	<span class="keyword">if</span> [ ! <span class="string">"`ls <span class="variable">$i</span>/new`"</span> = <span class="string">""</span> ] ; <span class="keyword">then</span></div><div class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$COLOR_SET</span>"</span><span class="string">"[<span class="variable">$i</span>]"</span><span class="string">"<span class="variable">$COLOR_RESTORE</span>"</span></div><div class="line">	<span class="keyword">fi</span></div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jingbei.li/2015/01/09/a-simple-byobu-script-to-notify-your-new-mails-and-feeds/" data-id="citb7p0900005fxfjhk8rmwkx" class="article-share-link">Teilen</a>
      
        <a href="http://jingbei.li/2015/01/09/a-simple-byobu-script-to-notify-your-new-mails-and-feeds/#disqus_thread" class="article-comment-link">Kommentare</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/byobu/">byobu</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rssdrop/">rssdrop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/script/">script</a></li></ul>

    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/abook/">abook</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/astyle/">astyle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bat/">bat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/byobu/">byobu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cocos2dx/">cocos2dx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cpp/">cpp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/desktop-game/">desktop game</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ffmpeg/">ffmpeg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gtest/">gtest</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hardware/">hardware</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ipv6/">ipv6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jekyll/">jekyll</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logs/">logs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mutt/">mutt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openwrt/">openwrt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raspberry-pi/">raspberry pi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rssdrop/">rssdrop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ruby/">ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/script/">script</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/thinkpad/">thinkpad</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tmux/">tmux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wine/">wine</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yourls/">yourls</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/abook/" style="font-size: 10px;">abook</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/astyle/" style="font-size: 10px;">astyle</a> <a href="/tags/bat/" style="font-size: 10px;">bat</a> <a href="/tags/byobu/" style="font-size: 12.5px;">byobu</a> <a href="/tags/c/" style="font-size: 10px;">c</a> <a href="/tags/c/" style="font-size: 15px;">c++</a> <a href="/tags/cocos2dx/" style="font-size: 10px;">cocos2dx</a> <a href="/tags/cpp/" style="font-size: 10px;">cpp</a> <a href="/tags/desktop-game/" style="font-size: 10px;">desktop game</a> <a href="/tags/ffmpeg/" style="font-size: 10px;">ffmpeg</a> <a href="/tags/gtest/" style="font-size: 10px;">gtest</a> <a href="/tags/hardware/" style="font-size: 10px;">hardware</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/ipv6/" style="font-size: 10px;">ipv6</a> <a href="/tags/jekyll/" style="font-size: 10px;">jekyll</a> <a href="/tags/linux/" style="font-size: 20px;">linux</a> <a href="/tags/logs/" style="font-size: 12.5px;">logs</a> <a href="/tags/mutt/" style="font-size: 12.5px;">mutt</a> <a href="/tags/openwrt/" style="font-size: 10px;">openwrt</a> <a href="/tags/php/" style="font-size: 10px;">php</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/raspberry-pi/" style="font-size: 10px;">raspberry pi</a> <a href="/tags/rssdrop/" style="font-size: 12.5px;">rssdrop</a> <a href="/tags/ruby/" style="font-size: 10px;">ruby</a> <a href="/tags/script/" style="font-size: 17.5px;">script</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/thinkpad/" style="font-size: 10px;">thinkpad</a> <a href="/tags/tmux/" style="font-size: 10px;">tmux</a> <a href="/tags/windows/" style="font-size: 12.5px;">windows</a> <a href="/tags/wine/" style="font-size: 10px;">wine</a> <a href="/tags/yourls/" style="font-size: 10px;">yourls</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/09/18/迁移至hexo/">迁移至hexo</a>
          </li>
        
          <li>
            <a href="/2016/01/03/raspberry-pi-android-robot/">用raspberry pi做一个android机器人</a>
          </li>
        
          <li>
            <a href="/2016/01/02/面向对象手法解OJ题/">面向对象手法解OJ题</a>
          </li>
        
          <li>
            <a href="/2016/01/02/论如何给一门课出大作业及评测系统/">论如何给一门课出大作业及评测系统</a>
          </li>
        
          <li>
            <a href="/2015/12/29/我来给大家科普一下什么叫C模拟面向对象/">我来给大家科普一下什么叫C模拟面向对象</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Jingbei Li<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'jingbei';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>




  </div>
</body>
</html>