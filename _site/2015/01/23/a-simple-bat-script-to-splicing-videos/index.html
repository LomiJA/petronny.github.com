
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="author" content="Jingbei Li" />
    <title>A simple bat script to splicing videos</title>

    <link rel="stylesheet" href="/assets/themes/dinky/css/styles.css">
    <link rel="stylesheet" href="/assets/themes/dinky/css/pygment_trac.css">
    <script src="/assets/themes/dinky/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header"><a href="/">Jingbei Li's Blog</a></h1>
        <p class="header">Welcome!</p>
        <ul>
          
          
          


  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/index.html">Homepage</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/timeline.html">Timeline</a></li>
      	
      
    
  



	  <li><a href="/about.html" rel="me">About me</a></li>
        </ul>
	<!--<h4>Quick Links</h4>
        <ul>
	  <li><a href="/index.html#recent-posts" rel="me">Recent Posts</a></li>
	  <li><a href="/index.html#github-activity" rel="me">Github Activity</a></li>
	  <li><a href="/index.html#recent-comments" rel="me">Recent Comments</a></li>
        </ul>-->
        <ul>
	  <li><a href="/links.html">Other links</a></li>
        </ul>
        <ul>
	  <li><a href="/rss.xml">RSS</a>/<a href="/atom.xml">Atom</a></li>
        </ul>
        
        
        <div class="misc vcard">
	  <!--<h4>About</h4>-->
          <ul>
            
            <!--<li class="contact"><address><span class="author fn n">Jingbei Li</span> - <span class="fn email">jingbei.li@yahoo.com</span></address></li>-->
            
            
            <!--<li class="github"><a href="http://github.com/petronny/" rel="me">github.com/petronny</a></li>-->
            
            
            <!--<li class="twitter"><a href="http://twitter.com/jingbei_li/" rel="me">twitter.com/jingbei_li</a></li>-->
            
            
            
            
            
          </ul>
        </div><!-- misc -->
        
      </header>

      <section>
      
<section>
  <h1>A simple bat script to splicing videos</h1>

  <h4>23 January 2015</h4>


  
<p>Well, actually it’s a task given by my uncle. So the spirit of this script should be KISS, “Keep It Simple, Stupid”.</p>

<p>Instead of GUI, I choose ffmpeg to be the decoder(and the encoder if necessary). Luckily, ffmpeg has a <a href="http://ffmpeg.zeranoe.com/builds/">static windows binary build</a>. A good start!</p>

<p>The next part is writing a KISS script for windows. Because I’m not familiar to bat files at all, it took a while before I finally found out a trick to solve a problem about processing the files’ name.</p>

<p>The final version of the script looks like the following:</p>

<div class="highlight"><pre><code class="language-bat" data-lang="bat"><span class="p">@</span><span class="k">echo</span> <span class="k">off</span>
<span class="k">cd</span> <span class="n">/d</span> <span class="nv">%~dp0</span>
<span class="k">set</span> <span class="nv">ffmpeg</span><span class="o">=</span>bin\ffmpeg.exe
<span class="k">del</span> filelist.txt
<span class="k">del</span> splicing.mkv
<span class="nl">:LOOP</span>
<span class="k">IF</span> [<span class="nv">%1</span>]<span class="o">==</span>[] <span class="k">GOTO</span> <span class="nl">END</span>
	<span class="k">set</span> <span class="nv">filename</span><span class="o">=</span><span class="nv">%1</span>
	<span class="k">echo</span> file ^<span class="s1">&#39;%~1^&#39;</span> &gt;<span class="p">&gt;</span><span class="n">filelist</span>.txt 
	<span class="k">SHIFT</span>
<span class="k">GOTO</span> <span class="nl">LOOP</span>
<span class="nl">:END</span>
<span class="nv">%ffmpeg%</span> -f concat -i filelist.txt -c copy splicing.mkv
rename splicing.mkv spliced.mkv
<span class="k">del</span> filelist.txt</code></pre></div>

<p>The trick is using <code>%~1</code> to remove the <code>"</code> around the strings with spaces. Then force adding <code>'</code> around all the filenames or else the <code>\</code> will be escaped.</p>

<p>The usage of this script is quite simple. Make sure <code>bin\ffmpeg.exe</code> exist then drag all the videos to the script file.<br />
By default, it will not recode the videos to increase efficiency. If it goes wrong, such as splicing videos with different sizes, or the videos need to recode, just edit the ffmpeg command to fix it.</p>


  
    <ul class="tag_box inline">
      
      


  
     
    	<li><a href="/tags.html#ffmpeg-ref">ffmpeg <span>1</span></a></li>
     
    	<li><a href="/tags.html#windows-ref">windows <span>2</span></a></li>
     
    	<li><a href="/tags.html#bat-ref">bat <span>1</span></a></li>
     
    	<li><a href="/tags.html#script-ref">script <span>5</span></a></li>
    
  



    </ul>
    

  


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'jingbei'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




</section>


      </section>

      <footer>
	<script src="//static.getclicky.com/js" type="text/javascript"></script>
	<script type="text/javascript">try{ clicky.init(100811122); }catch(e){}</script>
	<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100811122ns.gif" /></p></noscript>
	<style type="text/css"> 
		#outerdiv 
		{ 
			width:150px; 
			height:145px; 
			overflow:hidden; 
			position:relative; 
		} 
		#inneriframe 
		{ 
			position:absolute; 
			top:-24px; 
			left:-5px; 
			width:150; 
			height:170; 
		} 
	</style> 
	<div id='outerdiv'> 
		<iframe id='inneriframe' frameborder=0 scrolling=no width=160 height=170 src='//widgets.clicky.com/tally/iframe?site_id=100811122&sitekey=f1e4ee97d7209bdfe74c0ce79738c86c&hide_title=1&hide_branding=1&'></iframe>
	</div>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
  </body>
</html>

